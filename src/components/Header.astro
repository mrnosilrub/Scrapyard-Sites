---
import logoUrl from "../assets/logo.svg?url"
import { withBase } from "../lib/paths"
const currentPath = Astro.url.pathname
---
<header class="sticky top-0 z-40 bg-white shadow-header">
  <input id="nav-toggle" type="checkbox" class="peer sr-only" />
  <div class="container">
    <div class="flex h-16 items-center justify-between">
      <a href={withBase('/')} class="flex items-center gap-3">
        <img src={logoUrl} alt="Scrapyard Sites" class="h-8 w-8" />
        <span class="text-lg font-semibold tracking-tight">
          <span class="text-brand-orange">Scrapyard</span> Sites
        </span>
      </a>

      <nav class="hidden md:flex items-center gap-6 text-sm font-medium" role="navigation" aria-label="Primary">
        <a href={withBase('/services/')} aria-current={currentPath.startsWith(withBase('/services/')) ? 'page' : undefined} class={`hover:text-brand-orange focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange rounded-sm ${currentPath.startsWith(withBase('/services/')) ? 'text-brand-orange' : ''}`}>Services</a>
        <a href={withBase('/process/')} aria-current={currentPath.startsWith(withBase('/process/')) ? 'page' : undefined} class={`hover:text-brand-orange focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange rounded-sm ${currentPath.startsWith(withBase('/process/')) ? 'text-brand-orange' : ''}`}>Process</a>
        <a href={withBase('/pricing/')} aria-current={currentPath.startsWith(withBase('/pricing/')) ? 'page' : undefined} class={`hover:text-brand-orange focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange rounded-sm ${currentPath.startsWith(withBase('/pricing/')) ? 'text-brand-orange' : ''}`}>Pricing</a>
        <a href={withBase('/calculator/')} aria-current={currentPath.startsWith(withBase('/calculator/')) ? 'page' : undefined} class={`hover:text-brand-orange focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange rounded-sm ${currentPath.startsWith(withBase('/calculator/')) ? 'text-brand-orange' : ''}`}>Calculator</a>
        <a href={withBase('/about/')} aria-current={currentPath.startsWith(withBase('/about/')) ? 'page' : undefined} class={`hover:text-brand-orange focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange rounded-sm ${currentPath.startsWith(withBase('/about/')) ? 'text-brand-orange' : ''}`}>About</a>
        <a href={withBase('/contact/')} aria-current={currentPath.startsWith(withBase('/contact/')) ? 'page' : undefined} class={`hover:text-brand-orange focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange rounded-sm ${currentPath.startsWith(withBase('/contact/')) ? 'text-brand-orange' : ''}`}>Contact</a>
      </nav>

      <div class="hidden md:flex">
        <a href={withBase('/contact/')} class="btn btn-primary px-4 py-2" data-goal="CTA: Book Discovery">
          Book a Discovery Call
        </a>
      </div>

      <label for="nav-toggle" class="md:hidden inline-flex items-center justify-center rounded-md p-2 text-zinc-700 hover:bg-zinc-100" aria-label="Open Menu" role="button" aria-controls="mobile-nav" aria-expanded="false">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
      </label>
    </div>
  </div>

      <div id="mobile-nav" class="fixed inset-0 z-50 hidden bg-white peer-checked:block" role="dialog" aria-modal="true" aria-label="Site Navigation">
    <div class="flex h-full flex-col">
      <div class="container h-16 flex items-center justify-between shadow-header">
        <a href={withBase('/')} class="flex items-center gap-3">
          <img src={logoUrl} alt="Scrapyard Sites" class="h-8 w-8" />
          <span class="text-lg font-semibold tracking-tight"><span class="text-brand-orange">Scrapyard</span> Sites</span>
        </a>
        <label for="nav-toggle" class="inline-flex items-center justify-center rounded-md p-2 text-zinc-700 hover:bg-zinc-100" aria-label="Close Menu" role="button" aria-controls="mobile-nav" aria-expanded="false">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
        </label>
      </div>
      <nav class="flex-1 p-8 text-lg font-medium space-y-6" aria-label="Mobile Navigation">
        <a href={withBase('/services/')} aria-current={currentPath.startsWith(withBase('/services/')) ? 'page' : undefined} class={`block focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange rounded-sm ${currentPath.startsWith(withBase('/services/')) ? 'text-brand-orange' : ''}`}>Services</a>
        <a href={withBase('/process/')} aria-current={currentPath.startsWith(withBase('/process/')) ? 'page' : undefined} class={`block focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange rounded-sm ${currentPath.startsWith(withBase('/process/')) ? 'text-brand-orange' : ''}`}>Process</a>
        <a href={withBase('/pricing/')} aria-current={currentPath.startsWith(withBase('/pricing/')) ? 'page' : undefined} class={`block focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange rounded-sm ${currentPath.startsWith(withBase('/pricing/')) ? 'text-brand-orange' : ''}`}>Pricing</a>
        <a href={withBase('/calculator/')} aria-current={currentPath.startsWith(withBase('/calculator/')) ? 'page' : undefined} class={`block focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange rounded-sm ${currentPath.startsWith(withBase('/calculator/')) ? 'text-brand-orange' : ''}`}>Calculator</a>
        <a href={withBase('/about/')} aria-current={currentPath.startsWith(withBase('/about/')) ? 'page' : undefined} class={`block focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange rounded-sm ${currentPath.startsWith(withBase('/about/')) ? 'text-brand-orange' : ''}`}>About</a>
        <a href={withBase('/contact/')} aria-current={currentPath.startsWith(withBase('/contact/')) ? 'page' : undefined} class={`block focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-orange rounded-sm ${currentPath.startsWith(withBase('/contact/')) ? 'text-brand-orange' : ''}`}>Contact</a>
      </nav>
      <div class="p-8">
        <a href={withBase('/contact/')} class="btn btn-primary w-full px-4 py-3">
          Book a Discovery Call
        </a>
      </div>
    </div>
  </div>
</header>

<script is:inline>
  (function() {
    var checkbox = document.getElementById('nav-toggle');
    var overlay = document.getElementById('mobile-nav');
    var toggles = document.querySelectorAll("label[for='nav-toggle']");

    function setState() {
      var open = !!(checkbox && checkbox.checked);
      toggles.forEach(function(el){ el.setAttribute('aria-expanded', open ? 'true' : 'false'); });
      document.documentElement.classList.toggle('overflow-hidden', open);
      document.body.classList.toggle('overflow-hidden', open);
      if (open && overlay) {
        var first = overlay.querySelector('a, button, [tabindex]:not([tabindex="-1"])');
        if (first && typeof first.focus === 'function') first.focus();
      }
    }

    if (checkbox) checkbox.addEventListener('change', setState);
    document.addEventListener('keydown', function(e){
      if (e.key === 'Escape' && checkbox && checkbox.checked) {
        checkbox.checked = false;
        setState();
      }
    });
    if (overlay) overlay.addEventListener('click', function(e){
      var t = e.target;
      if (t && t.tagName === 'A' && checkbox) {
        checkbox.checked = false;
        setState();
      }
    });
    setState();
  })();
</script>

